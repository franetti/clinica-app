<div class="turnos-admin-container">
  <mat-card class="header-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>event_note</mat-icon>
        Gestión de Turnos - Clínica
      </mat-card-title>
      <mat-card-subtitle>
        Administración de todos los turnos de la clínica
      </mat-card-subtitle>
    </mat-card-header>
  </mat-card>

  <!-- Filtros -->
  <mat-card class="filtros-card">
    <mat-card-content>
      <div class="filtros-container">
        <h3>
          <mat-icon>filter_list</mat-icon>
          Filtrar Turnos
        </h3>
        
        <div class="filtro-row">
          <mat-form-field appearance="outline" class="filtro-input">
            <mat-label>Buscar por Especialidad, Especialista o Paciente</mat-label>
            <input
              matInput
              [(ngModel)]="filtroTexto"
              (ngModelChange)="onFiltroChange()"
              placeholder="Ej: Cardiología, Dr. García, Juan Pérez...">
            <mat-icon matPrefix>search</mat-icon>
            <button
              mat-icon-button
              matSuffix
              *ngIf="filtroTexto"
              (click)="limpiarFiltros()"
              matTooltip="Limpiar filtro">
              <mat-icon>clear</mat-icon>
            </button>
          </mat-form-field>

          <div class="filtro-info">
            <mat-icon>info</mat-icon>
            <span>Mostrando {{ turnosFiltrados.length }} de {{ turnos.length }} turnos</span>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading -->
  <div *ngIf="cargando" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando turnos...</p>
  </div>

  <!-- Sin turnos -->
  <mat-card *ngIf="!cargando && turnos.length === 0" class="no-turnos">
    <mat-icon>event_busy</mat-icon>
    <p>No hay turnos registrados en la clínica</p>
  </mat-card>

  <!-- Lista de turnos -->
  <div *ngIf="!cargando && turnosFiltrados.length > 0" class="turnos-list">
    <mat-card *ngFor="let turno of turnosFiltrados" class="turno-card" [class.turno-cancelado]="turno.estadoTurno === 'cancelado'">
      <mat-card-content>
        <div class="turno-content">
          <!-- Info principal -->
          <div class="turno-info-principal">
            <div class="turno-fecha">
              <mat-icon>calendar_today</mat-icon>
              <div>
                <span class="fecha-label">Fecha y Hora</span>
                <span class="fecha-valor">{{ formatearFecha(turno.fecha) }}</span>
              </div>
            </div>

            <div class="turno-especialidad">
              <mat-icon>medical_services</mat-icon>
              <div>
                <span class="info-label">Especialidad</span>
                <span class="info-valor">{{ turno.especialidad }}</span>
              </div>
            </div>
          </div>

          <!-- Info personas -->
          <div class="turno-personas">
            <div class="persona-info">
              <mat-icon>person</mat-icon>
              <div>
                <span class="info-label">Paciente</span>
                <span class="info-valor">{{ turno.nombrePaciente }}</span>
              </div>
            </div>

            <div class="persona-info">
              <mat-icon>local_hospital</mat-icon>
              <div>
                <span class="info-label">Especialista</span>
                <span class="info-valor">{{ turno.nombreEspecialista }}</span>
              </div>
            </div>
          </div>

          <!-- Estado -->
          <div class="turno-estado">
            <mat-chip [class]="getEstadoClass(turno.estadoTurno)">
              <mat-icon>{{ getEstadoIcon(turno.estadoTurno) }}</mat-icon>
              {{ getEstadoTexto(turno.estadoTurno) }}
            </mat-chip>
          </div>

          <!-- Comentario si existe -->
          <div *ngIf="turno.comentario" class="turno-comentario">
            <mat-icon>comment</mat-icon>
            <div>
              <span class="comentario-label">Comentario:</span>
              <span class="comentario-texto">{{ turno.comentario }}</span>
            </div>
          </div>

          <!-- Acciones -->
          <div class="turno-acciones">
            <button
              *ngIf="puedeCancelar(turno)"
              mat-raised-button
              color="warn"
              (click)="abrirDialogoCancelar(turno)"
              matTooltip="Cancelar turno">
              <mat-icon>cancel</mat-icon>
              Cancelar Turno
            </button>
            
            <span *ngIf="!puedeCancelar(turno)" class="no-cancelable">
              <mat-icon>info</mat-icon>
              No se puede cancelar
            </span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Sin resultados de filtro -->
  <mat-card *ngIf="!cargando && turnos.length > 0 && turnosFiltrados.length === 0" class="no-resultados">
    <mat-icon>search_off</mat-icon>
    <p>No se encontraron turnos con el filtro aplicado</p>
    <button mat-raised-button color="primary" (click)="limpiarFiltros()">
      <mat-icon>clear</mat-icon>
      Limpiar Filtros
    </button>
  </mat-card>
</div>


