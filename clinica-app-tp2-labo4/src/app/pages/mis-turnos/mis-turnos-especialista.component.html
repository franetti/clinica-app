<div class="mis-turnos-container">
  <mat-card class="header-card">
    <mat-card-header>
      <mat-card-title>
        Mis Turnos
      </mat-card-title>
      <mat-card-subtitle>
        Gestione sus turnos asignados
      </mat-card-subtitle>
    </mat-card-header>
  </mat-card>

  <mat-card class="filtros-card">
    <mat-card-content>
      <div class="filtros-container">
        <h3>
          Filtrar Turnos
        </h3>
        
        <div class="filtro-row">
          <mat-form-field appearance="outline" class="filtro-input">
            <mat-label>Buscar por Especialidad, Paciente o Historia Clínica</mat-label>
            <input
              matInput
              [(ngModel)]="filtroTexto"
              placeholder="Ej: Cardiología, Juan Pérez, altura, peso, caries...">
            <button
              mat-icon-button
              matSuffix
              *ngIf="filtroTexto"
              (click)="limpiarFiltros()"
              matTooltip="Limpiar filtro">
              <mat-icon>clear</mat-icon>
            </button>
          </mat-form-field>         
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <div *ngIf="cargando" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando turnos...</p>
  </div>

  <mat-card *ngIf="!cargando && turnos.length === 0" class="no-turnos">
    <p>No tiene turnos asignados</p>
    <p class="subtitle">Los turnos aparecerán aquí cuando los pacientes los soliciten</p>
  </mat-card>

  <div *ngIf="!cargando && (turnos | filtroTurnos:filtroTexto:opcionesFiltro).length > 0" class="turnos-list">
    <mat-card *ngFor="let turno of turnos | filtroTurnos:filtroTexto:opcionesFiltro" class="turno-card">
      <mat-card-content>
        <div class="turno-content">
          <div class="turno-header" >
            <p style="font-weight: blod;font-size: 30px; margin: 0;">Estado: </p>
            <mat-chip [class]="turno.estadoTurno | estadoTurno:'clase'" style="margin-left: 10px; font-size: 18px;display: flex; align-items: center; padding: 5px 10px;">
              
              <span style="font-weight: bold;">{{ turno.estadoTurno | estadoTurno }}</span>
            </mat-chip>
          </div>

          <div class="turno-info-principal">
            <div class="turno-fecha">
              <div>
                <span class="info-label">Fecha y Hora</span>
                <span class="info-valor">{{ formatearFecha(turno.fecha) }}</span>
              </div>
            </div>

            <div class="turno-especialidad">
              <div>
                <span class="info-label">Especialidad</span>
                <span class="info-valor">{{ turno.especialidad }}</span>
              </div>
            </div>

            <div class="turno-paciente">
              <div>
                <span class="info-label">Paciente</span>
                <span class="info-valor">{{ turno.nombrePaciente }}</span>
              </div>
            </div>
          </div>

          <div class="turno-acciones">
            <button
              *ngIf="puedeAceptar(turno)"
              mat-raised-button
              color="primary"
              (click)="aceptarTurno(turno)">
              Aceptar
            </button>

            <button
              *ngIf="puedeFinalizar(turno)"
              mat-raised-button
              color="accent"
              (click)="finalizarTurno(turno)">
              Finalizar
            </button>

            <button
              *ngIf="puedeRechazar(turno)"
              mat-stroked-button
              color="warn"
              (click)="rechazarTurno(turno)">
              Rechazar
            </button>

            <button
              *ngIf="puedeCancelar(turno)"
              mat-stroked-button
              color="warn"
              (click)="cancelarTurno(turno)">
              Cancelar
            </button>

            <button
              *ngIf="puedeVerResenia(turno)"
              mat-stroked-button
              color="primary"
              (click)="verResenia(turno)">
              Ver Reseña
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card *ngIf="!cargando && turnos.length > 0 && (turnos | filtroTurnos:filtroTexto:opcionesFiltro).length === 0" class="no-resultados">
    <mat-icon>search_off</mat-icon>
    <p>No se encontraron turnos con el filtro aplicado</p>
    <button mat-raised-button color="primary" (click)="limpiarFiltros()">
      <mat-icon>clear</mat-icon>
      Limpiar Filtros
    </button>
  </mat-card>
</div>
