<div class="estadisticas-container">
  <mat-card class="header-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>bar_chart</mat-icon>
        Estadísticas y Reportes
      </mat-card-title>
      <mat-card-subtitle>
        Descargue los informes en formato Excel
      </mat-card-subtitle>
    </mat-card-header>
  </mat-card>

  <div *ngIf="cargando" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando datos...</p>
  </div>

  <mat-card class="filtros-card" *ngIf="!cargando">
    <mat-card-content>
      <h3>Filtrar por Rango de Fechas (para reportes de turnos)</h3>
      <div class="filtros-row">
        <mat-form-field appearance="outline">
          <mat-label>Fecha Inicio</mat-label>
          <input matInput [matDatepicker]="pickerInicio" [(ngModel)]="fechaInicio">
          <mat-datepicker-toggle matIconSuffix [for]="pickerInicio"></mat-datepicker-toggle>
          <mat-datepicker #pickerInicio></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Fecha Fin</mat-label>
          <input matInput [matDatepicker]="pickerFin" [(ngModel)]="fechaFin">
          <mat-datepicker-toggle matIconSuffix [for]="pickerFin"></mat-datepicker-toggle>
          <mat-datepicker #pickerFin></mat-datepicker>
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="aplicarFiltroFechas()">
          <mat-icon>filter_list</mat-icon>
          Aplicar Filtro
        </button>

        <button mat-raised-button (click)="limpiarFiltroFechas()">
          <mat-icon>clear</mat-icon>
          Limpiar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <div *ngIf="!cargando" class="reportes-container">
    <!-- Primera fila: 3 columnas - Gráficos de torta -->
    <div class="reportes-row reportes-row-pie">
      <mat-card class="reporte-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>medical_services</mat-icon>
            Turnos por Especialidad
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Descargue el reporte de turnos agrupados por especialidad con fechas y detalles.</p>
          <div class="chart-container" *ngIf="!cargando && turnos.length > 0">
            <canvas #especialidadChart></canvas>
          </div>
          <p *ngIf="!cargando && turnos.length === 0" class="no-data-message">
            No hay turnos para mostrar
          </p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="descargarExcelTurnosEspecialidad()" [disabled]="turnos.length === 0">
            <mat-icon>download</mat-icon>
            Descargar Excel 
          </button>
        </mat-card-actions>
      </mat-card>

      <mat-card class="reporte-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>person</mat-icon>
            Turnos Solicitados por Médico
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Descargue el reporte de turnos solicitados por cada médico en el rango de fechas seleccionado.</p>
          <div class="chart-container" *ngIf="!cargando && turnos.length > 0">
            <canvas #turnosSolicitadosChart></canvas>
          </div>
          <p *ngIf="!cargando && turnos.length === 0" class="no-data-message">
            No hay turnos para mostrar
          </p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="descargarExcelTurnosSolicitados()" [disabled]="turnos.length === 0">
            <mat-icon>download</mat-icon>
            Descargar Excel
          </button>
        </mat-card-actions>
      </mat-card>

      <mat-card class="reporte-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>check_circle</mat-icon>
            Turnos Finalizados por Médico
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Descargue el reporte de turnos finalizados por cada médico en el rango de fechas seleccionado.</p>
          <div class="chart-container" *ngIf="!cargando && turnos.length > 0">
            <canvas #turnosFinalizadosChart></canvas>
          </div>
          <p *ngIf="!cargando && turnos.length === 0" class="no-data-message">
            No hay turnos para mostrar
          </p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="descargarExcelTurnosFinalizados()" [disabled]="turnos.length === 0">
            <mat-icon>download</mat-icon>
            Descargar Excel
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- Segunda fila: 2 columnas - Gráficos de bar solo en Excel -->
    <div class="reportes-row reportes-row-bar">
      <mat-card class="reporte-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>login</mat-icon>
            Log de Ingresos al Sistema
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Descargue el registro completo de ingresos al sistema con usuario, día y horario.</p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="descargarExcelLogs()" [disabled]="logs.length === 0">
            <mat-icon>download</mat-icon>
            Descargar Excel
          </button>
        </mat-card-actions>
      </mat-card>

      <mat-card class="reporte-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>calendar_today</mat-icon>
            Turnos por Día
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Descargue el reporte de turnos agrupados por día con fechas y detalles.</p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="descargarExcelTurnosDia()" [disabled]="turnos.length === 0">
            <mat-icon>download</mat-icon>
            Descargar Excel
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
